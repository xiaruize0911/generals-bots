"""
Simple example of running a single Generals.io game.

This demonstrates the basic game loop with two agents playing against each other.
"""
import numpy as np

from generals import GeneralsEnv, get_observation
from generals.agents import RandomAgent, ExpanderAgent


# =============================================================================
# Configuration - adjust these to your needs
# =============================================================================
GRID_DIMS = (10, 10)    # Grid size (height, width) - try (15, 15) for larger games
TRUNCATION = 500        # Max steps before game ends

# Create environment (generates state pool on reset)
env = GeneralsEnv(grid_dims=GRID_DIMS, truncation=TRUNCATION)

# Create agents
agent_0 = RandomAgent(id="Random")
agent_1 = ExpanderAgent(id="Expander")

# Initialize
state = env.reset(seed=42)

step_count = 0
terminated = truncated = False

while not (terminated or truncated):
    # Get observations for both players
    obs_0 = get_observation(state, 0)
    obs_1 = get_observation(state, 1)

    actions = np.stack([
        agent_0.act(obs_0, np.random.default_rng()),
        agent_1.act(obs_1, np.random.default_rng()),
    ])

    timestep, state = env.step(state, actions)

    terminated = bool(timestep.terminated)
    truncated = bool(timestep.truncated)
    step_count += 1

winner = timestep.info.winner
print(f"Game over! Winner: {winner}")
